<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Score Management System</title>
    <style>
        /* ============================================
           COMPLETE CSS - ALL STYLES INCLUDED
           ============================================ */
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --info: #17a2b8;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: var(--dark);
            min-height: 100vh;
            position: relative;
            transition: background 0.3s ease;
        }

        /* Dark Mode */
        body.dark-mode {
            background: #1a1a2e;
            color: #e6e6e6;
        }

        body.dark-mode .login-box,
        body.dark-mode .modal-content,
        body.dark-mode .form-container,
        body.dark-mode .table-container,
        body.dark-mode .report-card,
        body.dark-mode .stat-card,
        body.dark-mode .calendar,
        body.dark-mode .chart-container,
        body.dark-mode .announcements,
        body.dark-mode .messages {
            background: #16213e;
            color: #e6e6e6;
            border: 1px solid #0f3460;
        }

        body.dark-mode .notification {
            background: #16213e;
            color: #e6e6e6;
            border: 1px solid #0f3460;
        }

        body.dark-mode .sidebar {
            background: #0f3460;
            border-right: 1px solid #16213e;
        }

        body.dark-mode .header {
            background: #0f3460;
            border-bottom: 1px solid #16213e;
        }

        body.dark-mode .nav-item:hover {
            background: rgba(52, 152, 219, 0.2);
        }

        body.dark-mode .input-group input,
        body.dark-mode .input-group select,
        body.dark-mode .input-group textarea {
            background: #1a1a2e;
            color: #e6e6e6;
            border-color: #0f3460;
        }

        /* Login Screen */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 450px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.3);
            transition: all 0.3s ease;
        }

        .system-title {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .developer-credit {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        body.dark-mode .developer-credit {
            color: #aaa;
        }

        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .role-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .role-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            background: white;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .role-btn {
            background: #1a1a2e;
            border-color: #0f3460;
            color: #e6e6e6;
        }

        .role-btn:hover {
            transform: translateY(-3px);
            border-color: var(--secondary);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .role-btn.active {
            border-color: var(--secondary);
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.1), rgba(46, 204, 113, 0.1));
        }

        .role-btn i {
            font-size: 24px;
        }

        .role-btn.admin i { color: var(--primary); }
        .role-btn.teacher i { color: var(--secondary); }
        .role-btn.student i { color: var(--accent); }
        .role-btn.parent i { color: var(--warning); }

        .input-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
            font-weight: 600;
            font-size: 14px;
        }

        body.dark-mode .input-group label {
            color: #e6e6e6;
        }

        .input-group input, .input-group select, .input-group textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            font-size: 15px;
            transition: var(--transition);
            background: white;
        }

        .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
            border-color: var(--secondary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        .login-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
            border: none;
            border-radius: var(--radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(52, 152, 219, 0.3);
        }

        .forgot-password {
            text-align: right;
            margin-top: 10px;
        }

        .forgot-password a {
            color: var(--secondary);
            text-decoration: none;
            font-size: 13px;
            cursor: pointer;
        }

        .forgot-password a:hover {
            text-decoration: underline;
        }

        .signup-link {
            margin-top: 20px;
            font-size: 14px;
            color: #666;
        }

        body.dark-mode .signup-link {
            color: #aaa;
        }

        .signup-link a {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .signup-link a:hover {
            text-decoration: underline;
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Modal Content */
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0,0,0,0.25);
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            color: var(--primary);
            font-size: 24px;
            font-weight: 700;
        }

        body.dark-mode .modal-title {
            color: #e6e6e6;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: #f5f5f5;
            color: var(--danger);
        }

        body.dark-mode .close-btn:hover {
            background: #0f3460;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 25px;
        }

        body.dark-mode .tabs {
            border-bottom-color: #0f3460;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: none;
            color: #666;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        body.dark-mode .tab {
            color: #aaa;
        }

        .tab.active {
            color: var(--secondary);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--secondary);
            border-radius: 3px 3px 0 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Status Badges */
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending { background: #fff3cd; color: #856404; }
        .status-approved { background: #d4edda; color: #155724; }
        .status-rejected { background: #f8d7da; color: #721c24; }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .header {
            background: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            transition: all 0.3s ease;
        }

        .header-left h1 {
            color: var(--primary);
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        body.dark-mode .header-left h1 {
            color: #e6e6e6;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
            color: var(--primary);
        }

        body.dark-mode .user-info {
            color: #e6e6e6;
        }

        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 18px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }

        .role-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            color: white;
            text-transform: uppercase;
        }

        .role-badge.admin { background: linear-gradient(135deg, #8e44ad, #9b59b6); }
        .role-badge.teacher { background: linear-gradient(135deg, #3498db, #2980b9); }
        .role-badge.student { background: linear-gradient(135deg, #2ecc71, #27ae60); }
        .role-badge.parent { background: linear-gradient(135deg, #f39c12, #e67e22); }

        .logout-btn {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.3);
        }

        .main-content {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        .sidebar {
            width: 260px;
            background: #f8f9fa;
            padding: 25px 20px;
            border-right: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px;
            color: var(--primary);
            text-decoration: none;
            border-radius: var(--radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }

        body.dark-mode .nav-item {
            color: #e6e6e6;
        }

        .nav-item:hover {
            background: rgba(52, 152, 219, 0.1);
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.2), rgba(46, 204, 113, 0.2));
            color: var(--secondary);
            font-weight: 600;
        }

        .nav-item i {
            font-size: 18px;
            width: 24px;
        }

        .developer-footer {
            position: absolute;
            bottom: 25px;
            left: 20px;
            right: 20px;
            text-align: center;
            color: rgba(0,0,0,0.4);
            font-size: 13px;
            padding-top: 20px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        body.dark-mode .developer-footer {
            color: rgba(255,255,255,0.4);
            border-top-color: rgba(255,255,255,0.1);
        }

        .content-area {
            flex: 1;
            padding: 30px;
            background: #f5f7fa;
            overflow-y: auto;
            transition: all 0.3s ease;
        }

        body.dark-mode .content-area {
            background: #1a1a2e;
        }

        .page-title {
            color: var(--primary);
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(52, 152, 219, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .page-title {
            color: #e6e6e6;
            border-bottom-color: rgba(52, 152, 219, 0.2);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            border-left: 5px solid var(--secondary);
            transition: var(--transition);
        }

        body.dark-mode .stat-card {
            background: #16213e;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.12);
        }

        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        body.dark-mode .stat-card h3 {
            color: #aaa;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 10px;
        }

        body.dark-mode .stat-value {
            color: #e6e6e6;
        }

        .stat-change {
            font-size: 14px;
            color: var(--success);
        }

        /* Forms */
        .form-container {
            background: white;
            padding: 30px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), var(--accent));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #229954);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d68910);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #c0392b);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info), #117a8b);
            color: white;
        }

        /* Tables */
        .table-container {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: white;
            padding: 18px;
            text-align: left;
            font-weight: 600;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        body.dark-mode td {
            border-bottom-color: rgba(255,255,255,0.1);
        }

        tr:hover td {
            background: rgba(52, 152, 219, 0.05);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 25px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--success);
            max-width: 400px;
        }

        .notification.error { border-color: var(--danger); }
        .notification.warning { border-color: var(--warning); }
        .notification.info { border-color: var(--info); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .badge-success { background: var(--success); }
        .badge-warning { background: var(--warning); }
        .badge-danger { background: var(--danger); }
        .badge-info { background: var(--info); }
        .badge-primary { background: var(--primary); }

        /* Calendar */
        .calendar {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            padding: 15px;
            text-align: center;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid #eee;
        }

        body.dark-mode .calendar-day {
            border-color: #0f3460;
        }

        .calendar-day:hover {
            background: rgba(52, 152, 219, 0.1);
        }

        .calendar-day.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .calendar-day.event {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid rgba(46, 204, 113, 0.3);
        }

        /* Charts */
        .chart-container {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .chart {
            height: 300px;
            margin-top: 20px;
            background: #f8f9fa;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        body.dark-mode .chart {
            background: #0f3460;
            color: #aaa;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed #ddd;
            border-radius: var(--radius);
            padding: 40px;
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
        }

        body.dark-mode .file-upload {
            border-color: #0f3460;
        }

        .file-upload:hover {
            border-color: var(--secondary);
            background: rgba(52, 152, 219, 0.05);
        }

        .file-upload input {
            display: none;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Announcement Board */
        .announcements {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }

        .announcement {
            padding: 20px;
            border-left: 4px solid var(--secondary);
            background: #f8f9fa;
            margin-bottom: 15px;
            border-radius: var(--radius);
        }

        body.dark-mode .announcement {
            background: #0f3460;
        }

        /* Messaging */
        .messages {
            background: white;
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
            height: 500px;
            display: flex;
            flex-direction: column;
        }

        .message-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message-input {
            display: flex;
            gap: 10px;
        }

        .message {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: var(--radius);
            max-width: 70%;
        }

        .message.sent {
            background: rgba(52, 152, 219, 0.1);
            margin-left: auto;
        }

        .message.received {
            background: #f8f9fa;
        }

        body.dark-mode .message.received {
            background: #0f3460;
        }

        /* Watermark */
        .watermark {
            position: fixed;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.2);
            font-size: 12px;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            .nav-item span {
                display: none;
            }
            .content-area {
                padding: 20px;
            }
            .developer-footer {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .login-box {
                padding: 30px;
            }
            .role-selector {
                grid-template-columns: 1fr;
            }
            .main-content {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                padding: 20px;
                border-right: none;
                border-bottom: 1px solid rgba(0,0,0,0.05);
            }
            body.dark-mode .sidebar {
                border-bottom-color: #0f3460;
            }
            .nav-item span {
                display: inline;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .modal-content {
                padding: 25px;
                max-height: 95vh;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Login Screen -->
    <div class="login-container" id="loginScreen">
        <div class="login-box">
            <div class="version-badge">v3.0 Ultimate</div>
            <h1 class="system-title">
                <i class="fas fa-chart-line"></i> Digital Score Management System
            </h1>
            <div class="developer-credit">Ultimate Edition by Frank Jefwa</div>
            
            <div class="role-selector">
                <div class="role-btn admin active" onclick="selectRole('admin')">
                    <i class="fas fa-crown"></i>
                    <span>Administrator</span>
                </div>
                <div class="role-btn teacher" onclick="selectRole('teacher')">
                    <i class="fas fa-chalkboard-teacher"></i>
                    <span>Teacher</span>
                </div>
                <div class="role-btn student" onclick="selectRole('student')">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Student</span>
                </div>
                <div class="role-btn parent" onclick="selectRole('parent')">
                    <i class="fas fa-user-friends"></i>
                    <span>Parent</span>
                </div>
            </div>

            <div class="input-group">
                <label for="username"><i class="fas fa-user"></i> USERNAME</label>
                <input type="text" id="username" placeholder="Enter your username">
            </div>

            <div class="input-group">
                <label for="password"><i class="fas fa-lock"></i> PASSWORD</label>
                <input type="password" id="password" placeholder="Enter your password">
                <button type="button" class="password-toggle" onclick="togglePassword('password')" style="position: absolute; right: 15px; top: 42px; background: none; border: none; color: #999; cursor: pointer;">
                    <i class="fas fa-eye"></i>
                </button>
            </div>

            <div class="forgot-password">
                <a onclick="showForgotPassword()">Forgot Password?</a>
            </div>

            <button class="login-btn" onclick="login()">
                <i class="fas fa-sign-in-alt"></i> LOGIN TO SYSTEM
            </button>
            
            <div class="signup-link">
                Don't have an account? <a onclick="showSignup()">Sign Up</a>
            </div>

            <div style="margin-top: 20px; font-size: 12px; color: #666; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <input type="checkbox" id="rememberMe" style="margin-right: 5px;">
                    <label for="rememberMe">Remember me</label>
                </div>
                <div>
                    <button onclick="toggleDarkMode()" style="background: none; border: none; color: #666; cursor: pointer; font-size: 12px;">
                        <i class="fas fa-moon"></i> Dark Mode
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal-overlay" id="forgotPasswordModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Reset Password</h2>
                <button class="close-btn" onclick="hideForgotPassword()">&times;</button>
            </div>
            
            <div class="tabs">
                <button class="tab active" onclick="showTab('emailTab')">Email</button>
                <button class="tab" onclick="showTab('phoneTab')">Phone</button>
                <button class="tab" onclick="showTab('securityTab')">Security Questions</button>
            </div>
            
            <div id="emailTab" class="tab-content active">
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" id="resetEmail" placeholder="Enter your email">
                </div>
            </div>
            
            <div id="phoneTab" class="tab-content">
                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="tel" id="resetPhone" placeholder="Enter your phone number">
                </div>
            </div>
            
            <div id="securityTab" class="tab-content">
                <div class="input-group">
                    <label>Username</label>
                    <input type="text" id="resetUsername" placeholder="Enter your username">
                </div>
                <div class="input-group">
                    <label>Security Question</label>
                    <select id="securityQuestion">
                        <option value="">Select a question</option>
                        <option>What was your first pet's name?</option>
                        <option>What city were you born in?</option>
                        <option>What is your mother's maiden name?</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Answer</label>
                    <input type="text" id="securityAnswer" placeholder="Enter your answer">
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideForgotPassword()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="resetPassword()">
                    <i class="fas fa-key"></i> Reset Password
                </button>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal-overlay" id="signupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create Account</h2>
                <button class="close-btn" onclick="hideSignup()">&times;</button>
            </div>
            
            <div class="input-group">
                <label>Full Name *</label>
                <input type="text" id="signupName" placeholder="Enter your full name">
            </div>
            
            <div class="input-group">
                <label>Username *</label>
                <input type="text" id="signupUsername" placeholder="Choose a username">
            </div>
            
            <div class="input-group">
                <label>Email Address</label>
                <input type="email" id="signupEmail" placeholder="Enter your email">
            </div>
            
            <div class="input-group">
                <label>Phone Number</label>
                <input type="tel" id="signupPhone" placeholder="Enter phone number">
            </div>
            
            <div class="input-group">
                <label>Select Role *</label>
                <select id="signupRole" onchange="updateRoleFields()">
                    <option value="">Select your role</option>
                    <option value="admin">Administrator</option>
                    <option value="teacher">Teacher</option>
                    <option value="student">Student</option>
                    <option value="parent">Parent</option>
                </select>
            </div>
            
            <div class="input-group">
                <label>Password *</label>
                <input type="password" id="signupPassword" placeholder="Create a password">
                <button type="button" class="password-toggle" onclick="togglePassword('signupPassword')" style="position: absolute; right: 15px; top: 42px; background: none; border: none; color: #999; cursor: pointer;">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <div class="input-group">
                <label>Confirm Password *</label>
                <input type="password" id="signupConfirmPassword" placeholder="Confirm your password">
                <button type="button" class="password-toggle" onclick="togglePassword('signupConfirmPassword')" style="position: absolute; right: 15px; top: 42px; background: none; border: none; color: #999; cursor: pointer;">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="hideSignup()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-success" onclick="signup()">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div class="dashboard" id="dashboard">
        <div class="header">
            <div class="header-left">
                <h1>
                    <i class="fas fa-chart-line"></i> Digital Score Management System
                </h1>
            </div>
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">U</div>
                <div>
                    <div id="userName">User</div>
                    <div class="role-badge admin" id="userRole">Administrator</div>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-info btn-sm" onclick="showNotifications()">
                        <i class="fas fa-bell"></i>
                        <span id="notificationCount">0</span>
                    </button>
                    <button class="logout-btn" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="sidebar">
                <!-- Admin Navigation -->
                <div class="nav-section" id="adminNav" style="display: block;">
                    <div class="nav-item active" onclick="showPage('dashboardPage')">
                        <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                    </div>
                    <div class="nav-item" onclick="showPage('pendingApprovals')">
                        <i class="fas fa-user-check"></i> <span>Pending Approvals <span id="pendingApprovalsCount" class="badge badge-danger">0</span></span>
                    </div>
                    <div class="nav-item" onclick="showPage('addScores')">
                        <i class="fas fa-plus-circle"></i> <span>Add Scores</span>
                    </div>
                    <div class="nav-item" onclick="showPage('manageStudents')">
                        <i class="fas fa-users"></i> <span>Manage Students</span>
                    </div>
                    <div class="nav-item" onclick="showPage('viewAllScores')">
                        <i class="fas fa-eye"></i> <span>View All Scores</span>
                    </div>
                    <div class="nav-item" onclick="showPage('reports')">
                        <i class="fas fa-chart-bar"></i> <span>Reports & Analysis</span>
                    </div>
                    <div class="nav-item" onclick="showPage('reportCards')">
                        <i class="fas fa-file-certificate"></i> <span>Report Cards</span>
                    </div>
                    <div class="nav-item" onclick="showPage('classAnalysis')">
                        <i class="fas fa-chart-pie"></i> <span>Class Analysis</span>
                    </div>
                    <div class="nav-item" onclick="showPage('attendance')">
                        <i class="fas fa-calendar-check"></i> <span>Attendance</span>
                    </div>
                    <div class="nav-item" onclick="showPage('calendar')">
                        <i class="fas fa-calendar"></i> <span>Academic Calendar</span>
                    </div>
                    <div class="nav-item" onclick="showPage('announcements')">
                        <i class="fas fa-bullhorn"></i> <span>Announcements</span>
                    </div>
                    <div class="nav-item" onclick="showPage('userManagement')">
                        <i class="fas fa-users-cog"></i> <span>Manage Users</span>
                    </div>
                    <div class="nav-item" onclick="showPage('systemSettings')">
                        <i class="fas fa-cogs"></i> <span>System Settings</span>
                    </div>
                    <div class="nav-item" onclick="showPage('auditLog')">
                        <i class="fas fa-history"></i> <span>Audit Log</span>
                    </div>
                    <div class="nav-item" onclick="showPage('backupRestore')">
                        <i class="fas fa-database"></i> <span>Backup & Restore</span>
                    </div>
                    <div class="nav-item" onclick="showPage('achievements')">
                        <i class="fas fa-trophy"></i> <span>Achievements</span>
                    </div>
                </div>

                <div class="developer-footer">
                    Ultimate Edition v3.0<br>
                    By Frank Jefwa
                </div>
            </div>

            <div class="content-area">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page">
                    <h2 class="page-title">Admin Dashboard <span id="currentDate"></span></h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Students</h3>
                            <div class="stat-value" id="totalStudents">0</div>
                            <div class="stat-change"><i class="fas fa-users"></i> Registered students</div>
                        </div>
                        <div class="stat-card">
                            <h3>Average Score</h3>
                            <div class="stat-value" id="averageScore">0%</div>
                            <div class="stat-change"><i class="fas fa-chart-line"></i> Overall performance</div>
                        </div>
                        <div class="stat-card">
                            <h3>Attendance Rate</h3>
                            <div class="stat-value" id="attendanceRate">0%</div>
                            <div class="stat-change"><i class="fas fa-calendar-check"></i> This month</div>
                        </div>
                        <div class="stat-card">
                            <h3>Pending Actions</h3>
                            <div class="stat-value" id="pendingActions">0</div>
                            <div class="stat-change"><i class="fas fa-tasks"></i> Requires attention</div>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Quick Actions</h3>
                        <div style="display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="showPage('addScores')">
                                <i class="fas fa-plus"></i> Add New Scores
                            </button>
                            <button class="btn btn-success" onclick="generateReport()">
                                <i class="fas fa-file-pdf"></i> Generate Report
                            </button>
                            <button class="btn btn-info" onclick="showPage('announcements')">
                                <i class="fas fa-bullhorn"></i> Post Announcement
                            </button>
                            <button class="btn btn-danger" onclick="backupData()">
                                <i class="fas fa-save"></i> Backup Data
                            </button>
                            <button class="btn btn-warning" onclick="showPage('pendingApprovals')">
                                <i class="fas fa-user-check"></i> Review Approvals
                            </button>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>Performance Trends</h3>
                        <div class="chart" id="performanceChart">
                            <div style="text-align: center; padding: 50px;">
                                <i class="fas fa-chart-line" style="font-size: 48px; color: #3498db; margin-bottom: 20px;"></i>
                                <p>Chart visualization would appear here</p>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Integrate with Chart.js or similar library</p>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Recent Score Entries</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Subject</th>
                                    <th>Score</th>
                                    <th>Grade</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentScoresTable">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #666;">No scores entered yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Pending Approvals Page -->
                <div id="pendingApprovals" class="page" style="display: none;">
                    <h2 class="page-title">Pending User Approvals</h2>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Username</th>
                                    <th>Email</th>
                                    <th>Role</th>
                                    <th>Request Date</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingApprovalsTable">
                                <tr><td colspan="7" style="text-align: center; padding: 30px; color: #666;">No pending approvals</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="form-container">
                        <h3>Approval Statistics</h3>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>Total Pending</h3>
                                <div class="stat-value" id="totalPendingApprovals">0</div>
                                <div class="stat-change"><i class="fas fa-clock"></i> Awaiting review</div>
                            </div>
                            <div class="stat-card">
                                <h3>Approved Today</h3>
                                <div class="stat-value" id="approvedToday">0</div>
                                <div class="stat-change"><i class="fas fa-check-circle"></i> Approved users</div>
                            </div>
                            <div class="stat-card">
                                <h3>Rejected Today</h3>
                                <div class="stat-value" id="rejectedToday">0</div>
                                <div class="stat-change"><i class="fas fa-times-circle"></i> Rejected users</div>
                            </div>
                            <div class="stat-card">
                                <h3>Avg. Response Time</h3>
                                <div class="stat-value" id="avgResponseTime">0h</div>
                                <div class="stat-change"><i class="fas fa-hourglass-half"></i> Time to approve</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add Scores Page -->
                <div id="addScores" class="page" style="display: none;">
                    <h2 class="page-title">Add Student Scores</h2>
                    <div class="form-container">
                        <h3>Enter Score Details</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Student Name *</label>
                                <select id="studentName" onchange="autoFillStudentInfo()">
                                    <option value="">Select Student</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Student ID</label>
                                <input type="text" id="studentId" placeholder="Auto-filled" readonly>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Subject *</label>
                                <select id="subjectName">
                                    <option value="">Select Subject</option>
                                    <option>Mathematics</option>
                                    <option>English</option>
                                    <option>Science</option>
                                    <option>History</option>
                                    <option>Geography</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Class/Form *</label>
                                <select id="className">
                                    <option value="">Select Class</option>
                                    <option>Form 1A</option>
                                    <option>Form 1B</option>
                                    <option>Form 2A</option>
                                    <option>Form 2B</option>
                                    <option>Form 3A</option>
                                    <option>Form 3B</option>
                                    <option>Form 4A</option>
                                    <option>Form 4B</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Score (0-100) *</label>
                                <input type="number" id="scoreValue" min="0" max="100" placeholder="Enter score">
                            </div>
                            <div class="input-group">
                                <label>Exam Type</label>
                                <select id="examType">
                                    <option>Term Exam</option>
                                    <option>Mid-Term</option>
                                    <option>Final Exam</option>
                                    <option>Continuous Assessment</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Comments</label>
                            <textarea id="scoreComments" rows="3" placeholder="Any additional comments..."></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="showPage('dashboardPage')">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                            <button class="btn btn-primary" onclick="saveScore()">
                                <i class="fas fa-save"></i> Save Score
                            </button>
                            <button class="btn btn-info" onclick="saveAndNotify()">
                                <i class="fas fa-bell"></i> Save & Notify
                            </button>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Bulk Import Scores</h3>
                        <div class="file-upload" onclick="document.getElementById('csvFile').click()">
                            <i class="fas fa-file-csv" style="font-size: 48px; color: #3498db; margin-bottom: 15px;"></i>
                            <p>Click to upload CSV file</p>
                            <p style="font-size: 12px; color: #666; margin-top: 10px;">Format: Student Name, Subject, Score, Class, Exam Type</p>
                            <input type="file" id="csvFile" accept=".csv" onchange="importCSV(this.files[0])" style="display: none;">
                        </div>
                        <div id="importProgress" style="display: none;">
                            <div class="spinner"></div>
                            <p style="text-align: center;">Importing...</p>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Recently Added Scores</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Subject</th>
                                    <th>Score</th>
                                    <th>Grade</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentAddedScores">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #666;">No scores added yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Attendance Page -->
                <div id="attendance" class="page" style="display: none;">
                    <h2 class="page-title">Attendance Tracking</h2>
                    <div class="form-container">
                        <h3>Mark Attendance</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Date</label>
                                <input type="date" id="attendanceDate" value="<?php echo date('Y-m-d'); ?>">
                            </div>
                            <div class="input-group">
                                <label>Class</label>
                                <select id="attendanceClass" onchange="loadClassAttendance()">
                                    <option value="">Select Class</option>
                                    <option>Form 1A</option>
                                    <option>Form 1B</option>
                                    <option>Form 2A</option>
                                    <option>Form 2B</option>
                                    <option>Form 3A</option>
                                    <option>Form 3B</option>
                                    <option>Form 4A</option>
                                    <option>Form 4B</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-container" id="attendanceTableContainer" style="display: none;">
                        <h3 style="padding: 20px 20px 0;">Class Attendance</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Status</th>
                                    <th>Remarks</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTable">
                            </tbody>
                        </table>
                        <div style="padding: 20px;">
                            <button class="btn btn-success" onclick="saveAttendance()">
                                <i class="fas fa-save"></i> Save Attendance
                            </button>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>Attendance Overview</h3>
                        <div class="chart" id="attendanceChart">
                            <div style="text-align: center; padding: 50px;">
                                <i class="fas fa-chart-pie" style="font-size: 48px; color: #2ecc71; margin-bottom: 20px;"></i>
                                <p>Attendance chart would appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Page -->
                <div id="calendar" class="page" style="display: none;">
                    <h2 class="page-title">Academic Calendar</h2>
                    <div class="calendar">
                        <div class="calendar-header">
                            <button class="btn btn-secondary btn-sm" onclick="prevMonth()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 id="currentMonth">January 2024</h3>
                            <button class="btn btn-secondary btn-sm" onclick="nextMonth()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid">
                            <!-- Calendar days will be generated by JavaScript -->
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Add Event</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Event Title</label>
                                <input type="text" id="eventTitle" placeholder="Enter event title">
                            </div>
                            <div class="input-group">
                                <label>Event Date</label>
                                <input type="date" id="eventDate">
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Description</label>
                            <textarea id="eventDescription" rows="3" placeholder="Event description"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="addEvent()">
                                <i class="fas fa-plus"></i> Add Event
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Upcoming Events</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Event</th>
                                    <th>Description</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="eventsTable">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Announcements Page -->
                <div id="announcements" class="page" style="display: none;">
                    <h2 class="page-title">Announcements</h2>
                    <div class="form-container">
                        <h3>Create Announcement</h3>
                        <div class="input-group">
                            <label>Title</label>
                            <input type="text" id="announcementTitle" placeholder="Enter announcement title">
                        </div>
                        <div class="input-group">
                            <label>Content</label>
                            <textarea id="announcementContent" rows="5" placeholder="Enter announcement content"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Audience</label>
                                <select id="announcementAudience" multiple style="height: 100px;">
                                    <option value="all">Everyone</option>
                                    <option value="students">Students Only</option>
                                    <option value="parents">Parents Only</option>
                                    <option value="teachers">Teachers Only</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Priority</label>
                                <select id="announcementPriority">
                                    <option value="normal">Normal</option>
                                    <option value="high">High</option>
                                    <option value="urgent">Urgent</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="postAnnouncement()">
                                <i class="fas fa-bullhorn"></i> Post Announcement
                            </button>
                        </div>
                    </div>

                    <div class="announcements" id="announcementsList">
                        <div style="text-align: center; padding: 50px; color: #666;">
                            <i class="fas fa-bullhorn" style="font-size: 48px; margin-bottom: 20px;"></i>
                            <p>No announcements yet</p>
                        </div>
                    </div>
                </div>

                <!-- Audit Log Page -->
                <div id="auditLog" class="page" style="display: none;">
                    <h2 class="page-title">System Audit Log</h2>
                    <div class="form-container">
                        <div class="form-row">
                            <div class="input-group">
                                <label>Filter by User</label>
                                <select id="auditUserFilter" onchange="filterAuditLog()">
                                    <option value="">All Users</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Filter by Action</label>
                                <select id="auditActionFilter" onchange="filterAuditLog()">
                                    <option value="">All Actions</option>
                                    <option value="login">Login</option>
                                    <option value="logout">Logout</option>
                                    <option value="add_score">Add Score</option>
                                    <option value="edit_score">Edit Score</option>
                                    <option value="delete_score">Delete Score</option>
                                    <option value="add_student">Add Student</option>
                                    <option value="add_user">Add User</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>User</th>
                                    <th>Action</th>
                                    <th>Details</th>
                                </tr>
                            </thead>
                            <tbody id="auditLogTable">
                                <tr><td colspan="4" style="text-align: center; padding: 30px; color: #666;">No audit logs yet</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="form-actions">
                        <button class="btn btn-secondary" onclick="exportAuditLog()">
                            <i class="fas fa-download"></i> Export Log
                        </button>
                        <button class="btn btn-danger" onclick="clearAuditLog()">
                            <i class="fas fa-trash"></i> Clear Log
                        </button>
                    </div>
                </div>

                <!-- Backup & Restore Page -->
                <div id="backupRestore" class="page" style="display: none;">
                    <h2 class="page-title">Data Backup & Restore</h2>
                    
                    <div class="form-container">
                        <h3>Create Backup</h3>
                        <p style="color: #666; margin-bottom: 20px;">Backup all system data to a secure file.</p>
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="createBackup()">
                                <i class="fas fa-save"></i> Create Backup Now
                            </button>
                            <button class="btn btn-info" onclick="scheduleBackup()">
                                <i class="fas fa-clock"></i> Schedule Auto Backup
                            </button>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Restore Data</h3>
                        <p style="color: #666; margin-bottom: 20px;">Restore system data from a backup file.</p>
                        <div class="file-upload" onclick="document.getElementById('backupFile').click()">
                            <i class="fas fa-file-upload" style="font-size: 48px; color: #e74c3c; margin-bottom: 15px;"></i>
                            <p>Click to select backup file</p>
                            <input type="file" id="backupFile" accept=".json" onchange="restoreBackup(this.files[0])" style="display: none;">
                        </div>
                        <div id="restoreProgress" style="display: none;">
                            <div class="spinner"></div>
                            <p style="text-align: center;">Restoring...</p>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Available Backups</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Backup Name</th>
                                    <th>Date Created</th>
                                    <th>Size</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="backupsTable">
                                <tr><td colspan="4" style="text-align: center; padding: 30px; color: #666;">No backups yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Achievements Page -->
                <div id="achievements" class="page" style="display: none;">
                    <h2 class="page-title">Achievements & Gamification</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Badges Awarded</h3>
                            <div class="stat-value" id="totalBadges">0</div>
                            <div class="stat-change"><i class="fas fa-trophy"></i> System-wide</div>
                        </div>
                        <div class="stat-card">
                            <h3>Top Student</h3>
                            <div class="stat-value" id="topStudentName">-</div>
                            <div class="stat-change"><i class="fas fa-crown"></i> Most achievements</div>
                        </div>
                        <div class="stat-card">
                            <h3>Active Streaks</h3>
                            <div class="stat-value" id="activeStreaks">0</div>
                            <div class="stat-change"><i class="fas fa-fire"></i> Current streaks</div>
                        </div>
                        <div class="stat-card">
                            <h3>Points Leader</h3>
                            <div class="stat-value" id="pointsLeader">0</div>
                            <div class="stat-change"><i class="fas fa-star"></i> Total points</div>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Award Achievement</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Student</label>
                                <select id="achievementStudent">
                                    <option value="">Select Student</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Achievement Type</label>
                                <select id="achievementType">
                                    <option value="">Select Type</option>
                                    <option value="perfect_score">Perfect Score (100%)</option>
                                    <option value="most_improved">Most Improved</option>
                                    <option value="attendance_perfect">Perfect Attendance</option>
                                    <option value="helpful">Most Helpful</option>
                                    <option value="leader">Class Leader</option>
                                </select>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Description</label>
                            <textarea id="achievementDescription" rows="3" placeholder="Achievement description"></textarea>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="awardAchievement()">
                                <i class="fas fa-award"></i> Award Achievement
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Recent Achievements</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student</th>
                                    <th>Achievement</th>
                                    <th>Date</th>
                                    <th>Points</th>
                                </tr>
                            </thead>
                            <tbody id="achievementsTable">
                                <tr><td colspan="4" style="text-align: center; padding: 30px; color: #666;">No achievements awarded yet</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="chart-container">
                        <h3>Achievement Distribution</h3>
                        <div class="chart" id="achievementsChart">
                            <div style="text-align: center; padding: 50px;">
                                <i class="fas fa-trophy" style="font-size: 48px; color: #f39c12; margin-bottom: 20px;"></i>
                                <p>Achievement chart would appear here</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- View All Scores Page -->
                <div id="viewAllScores" class="page" style="display: none;">
                    <h2 class="page-title">View All Scores</h2>
                    <div class="form-container">
                        <div class="form-row">
                            <div class="input-group">
                                <label>Filter by Class</label>
                                <select id="filterClass" onchange="filterScores()">
                                    <option value="">All Classes</option>
                                    <option>Form 1A</option>
                                    <option>Form 1B</option>
                                    <option>Form 2A</option>
                                    <option>Form 2B</option>
                                    <option>Form 3A</option>
                                    <option>Form 3B</option>
                                    <option>Form 4A</option>
                                    <option>Form 4B</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Filter by Subject</label>
                                <input type="text" id="filterSubject" placeholder="Enter subject name" oninput="filterScores()">
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Class</th>
                                    <th>Subject</th>
                                    <th>Score</th>
                                    <th>Grade</th>
                                    <th>Exam Type</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="allScoresTable">
                                <tr><td colspan="8" style="text-align: center; padding: 30px; color: #666;">No scores available</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Manage Students Page -->
                <div id="manageStudents" class="page" style="display: none;">
                    <h2 class="page-title">Manage Students</h2>
                    <div class="form-container">
                        <h3>Add New Student</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Full Name *</label>
                                <input type="text" id="newStudentName" placeholder="Enter student's full name">
                            </div>
                            <div class="input-group">
                                <label>Student ID</label>
                                <input type="text" id="newStudentId" placeholder="Generate automatically if empty">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Class *</label>
                                <select id="newStudentClass">
                                    <option value="">Select Class</option>
                                    <option>Form 1A</option>
                                    <option>Form 1B</option>
                                    <option>Form 2A</option>
                                    <option>Form 2B</option>
                                    <option>Form 3A</option>
                                    <option>Form 3B</option>
                                    <option>Form 4A</option>
                                    <option>Form 4B</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Date of Birth</label>
                                <input type="date" id="newStudentDOB">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Parent/Guardian Name</label>
                                <input type="text" id="newStudentParent" placeholder="Parent/Guardian name">
                            </div>
                            <div class="input-group">
                                <label>Contact Phone</label>
                                <input type="tel" id="newStudentPhone" placeholder="Phone number">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-secondary" onclick="clearStudentForm()">
                                <i class="fas fa-redo"></i> Clear
                            </button>
                            <button class="btn btn-success" onclick="addStudent()">
                                <i class="fas fa-user-plus"></i> Add Student
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Student List</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student ID</th>
                                    <th>Full Name</th>
                                    <th>Class</th>
                                    <th>Average Score</th>
                                    <th>Contact</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="studentsTable">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #666;">No students registered yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- User Management Page -->
                <div id="userManagement" class="page" style="display: none;">
                    <h2 class="page-title">Manage Users</h2>
                    <div class="form-container">
                        <h3>Create New User</h3>
                        <p style="color: #666; margin-bottom: 20px;">Only administrators can create new users.</p>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Username *</label>
                                <input type="text" id="newUsername" placeholder="Enter username">
                            </div>
                            <div class="input-group">
                                <label>Full Name *</label>
                                <input type="text" id="newFullName" placeholder="Enter full name">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Role *</label>
                                <select id="newUserRole">
                                    <option value="">Select Role</option>
                                    <option value="admin">Administrator</option>
                                    <option value="teacher">Teacher</option>
                                    <option value="student">Student</option>
                                    <option value="parent">Parent</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Password *</label>
                                <input type="password" id="newUserPassword" placeholder="Enter password">
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-success" onclick="createUser()">
                                <i class="fas fa-user-plus"></i> Create User
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">User List</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Full Name</th>
                                    <th>Role</th>
                                    <th>Created</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="usersTable">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #666;">No users found</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- System Settings Page -->
                <div id="systemSettings" class="page" style="display: none;">
                    <h2 class="page-title">System Settings</h2>
                    
                    <div class="form-container">
                        <h3>Academic Settings</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>School Name</label>
                                <input type="text" id="schoolName" placeholder="Enter school name">
                            </div>
                            <div class="input-group">
                                <label>Academic Year</label>
                                <input type="text" id="academicYear" placeholder="e.g., 2024-2025">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Pass Mark (%)</label>
                                <input type="number" id="passMark" min="0" max="100" value="40">
                            </div>
                            <div class="input-group">
                                <label>Maximum Score</label>
                                <input type="number" id="maxScore" min="0" value="100">
                            </div>
                        </div>
                        
                        <h3 style="margin-top: 30px;">Grading System</h3>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Grade</th>
                                        <th>Minimum Score</th>
                                        <th>Maximum Score</th>
                                        <th>Points</th>
                                    </tr>
                                </thead>
                                <tbody id="gradingSystem">
                                    <tr>
                                        <td>A</td>
                                        <td>80</td>
                                        <td>100</td>
                                        <td>12</td>
                                    </tr>
                                    <tr>
                                        <td>B</td>
                                        <td>70</td>
                                        <td>79</td>
                                        <td>10</td>
                                    </tr>
                                    <tr>
                                        <td>C</td>
                                        <td>60</td>
                                        <td>69</td>
                                        <td>8</td>
                                    </tr>
                                    <tr>
                                        <td>D</td>
                                        <td>50</td>
                                        <td>59</td>
                                        <td>6</td>
                                    </tr>
                                    <tr>
                                        <td>E</td>
                                        <td>40</td>
                                        <td>49</td>
                                        <td>4</td>
                                    </tr>
                                    <tr>
                                        <td>F</td>
                                        <td>0</td>
                                        <td>39</td>
                                        <td>2</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="saveSettings()">
                                <i class="fas fa-save"></i> Save Settings
                            </button>
                            <button class="btn btn-secondary" onclick="resetSettings()">
                                <i class="fas fa-redo"></i> Reset to Default
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Cards Page -->
                <div id="reportCards" class="page" style="display: none;">
                    <h2 class="page-title">Report Cards</h2>
                    
                    <div class="form-container">
                        <h3>Generate Report Card</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Student</label>
                                <select id="reportCardStudent">
                                    <option value="">Select Student</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Term</label>
                                <select id="reportCardTerm">
                                    <option value="1">Term 1</option>
                                    <option value="2">Term 2</option>
                                    <option value="3">Term 3</option>
                                    <option value="annual">Annual</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="generateReportCard()">
                                <i class="fas fa-file-pdf"></i> Generate Report Card
                            </button>
                            <button class="btn btn-success" onclick="previewReportCard()">
                                <i class="fas fa-eye"></i> Preview
                            </button>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Generated Report Cards</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    <th>Term</th>
                                    <th>Average Score</th>
                                    <th>Position</th>
                                    <th>Generated Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="reportCardsTable">
                                <tr><td colspan="6" style="text-align: center; padding: 30px; color: #666;">No report cards generated yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Reports & Analysis Page -->
                <div id="reports" class="page" style="display: none;">
                    <h2 class="page-title">Reports & Analysis</h2>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Performance Report</h3>
                            <div class="stat-value">85%</div>
                            <div class="stat-change">Overall school performance</div>
                        </div>
                        <div class="stat-card">
                            <h3>Top Class</h3>
                            <div class="stat-value">Form 4A</div>
                            <div class="stat-change">Average: 89%</div>
                        </div>
                        <div class="stat-card">
                            <h3>Best Subject</h3>
                            <div class="stat-value">Mathematics</div>
                            <div class="stat-change">Average: 91%</div>
                        </div>
                        <div class="stat-card">
                            <h3>Improvement</h3>
                            <div class="stat-value">+12%</div>
                            <div class="stat-change">Since last term</div>
                        </div>
                    </div>

                    <div class="form-container">
                        <h3>Generate Custom Report</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Report Type</label>
                                <select id="reportType">
                                    <option value="performance">Performance Report</option>
                                    <option value="attendance">Attendance Report</option>
                                    <option value="comparison">Class Comparison</option>
                                    <option value="subject">Subject Analysis</option>
                                    <option value="trend">Performance Trend</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Date Range</label>
                                <select id="reportDateRange">
                                    <option value="current_term">Current Term</option>
                                    <option value="last_term">Last Term</option>
                                    <option value="current_year">Current Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                        </div>
                        <div id="customDateRange" style="display: none;">
                            <div class="form-row">
                                <div class="input-group">
                                    <label>Start Date</label>
                                    <input type="date" id="reportStartDate">
                                </div>
                                <div class="input-group">
                                    <label>End Date</label>
                                    <input type="date" id="reportEndDate">
                                </div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button class="btn btn-primary" onclick="generateCustomReport()">
                                <i class="fas fa-chart-bar"></i> Generate Report
                            </button>
                            <button class="btn btn-success" onclick="exportReport()">
                                <i class="fas fa-download"></i> Export as PDF
                            </button>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>Performance Analysis</h3>
                        <div class="chart" id="reportsChart">
                            <div style="text-align: center; padding: 50px;">
                                <i class="fas fa-chart-pie" style="font-size: 48px; color: #3498db; margin-bottom: 20px;"></i>
                                <p>Report analysis chart would appear here</p>
                                <p style="font-size: 12px; color: #666; margin-top: 10px;">Visualize performance data</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Class Analysis Page -->
                <div id="classAnalysis" class="page" style="display: none;">
                    <h2 class="page-title">Class Analysis</h2>
                    
                    <div class="form-container">
                        <h3>Select Class for Analysis</h3>
                        <div class="form-row">
                            <div class="input-group">
                                <label>Class</label>
                                <select id="analysisClass" onchange="loadClassAnalysis()">
                                    <option value="">Select Class</option>
                                    <option>Form 1A</option>
                                    <option>Form 1B</option>
                                    <option>Form 2A</option>
                                    <option>Form 2B</option>
                                    <option>Form 3A</option>
                                    <option>Form 3B</option>
                                    <option>Form 4A</option>
                                    <option>Form 4B</option>
                                </select>
                            </div>
                            <div class="input-group">
                                <label>Subject</label>
                                <select id="analysisSubject">
                                    <option value="">All Subjects</option>
                                    <option>Mathematics</option>
                                    <option>English</option>
                                    <option>Science</option>
                                    <option>History</option>
                                    <option>Geography</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Class Average</h3>
                            <div class="stat-value" id="classAverage">0%</div>
                            <div class="stat-change">Overall performance</div>
                        </div>
                        <div class="stat-card">
                            <h3>Top Student</h3>
                            <div class="stat-value" id="classTopStudent">-</div>
                            <div class="stat-change">Highest score</div>
                        </div>
                        <div class="stat-card">
                            <h3>Pass Rate</h3>
                            <div class="stat-value" id="classPassRate">0%</div>
                            <div class="stat-change">Students passing</div>
                        </div>
                        <div class="stat-card">
                            <h3>Improvement</h3>
                            <div class="stat-value" id="classImprovement">0%</div>
                            <div class="stat-change">Since last term</div>
                        </div>
                    </div>

                    <div class="chart-container">
                        <h3>Class Performance Distribution</h3>
                        <div class="chart" id="classAnalysisChart">
                            <div style="text-align: center; padding: 50px;">
                                <i class="fas fa-chart-bar" style="font-size: 48px; color: #2ecc71; margin-bottom: 20px;"></i>
                                <p>Class analysis chart would appear here</p>
                            </div>
                        </div>
                    </div>

                    <div class="table-container">
                        <h3 style="padding: 20px 20px 0;">Class Ranking</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Position</th>
                                    <th>Student Name</th>
                                    <th>Average Score</th>
                                    <th>Grade</th>
                                    <th>Improvement</th>
                                </tr>
                            </thead>
                            <tbody id="classRankingTable">
                                <tr><td colspan="5" style="text-align: center; padding: 30px; color: #666;">Select a class to view analysis</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Watermark -->
    <div class="watermark">Digital Score Management System v3.0 | Ultimate Edition by Frank Jefwa</div>

    <!-- ============================================
         COMPLETE JAVASCRIPT - ALL FUNCTIONS INCLUDED
         ============================================ -->
    <script>
        // ============================================
        // CORE APPLICATION STATE
        // ============================================
        let currentUser = null;
        let currentRole = 'admin';
        let scoresData = [];
        let studentsData = [];
        let settingsData = {};
        let subjectsData = [];
        let usersData = [];
        let pendingApprovalsData = [];
        let attendanceData = [];
        let announcementsData = [];
        let messagesData = [];
        let eventsData = [];
        let achievementsData = [];
        let auditLogData = [];
        let backupsData = [];
        let apiLogData = [];
        let reportCardsData = [];
        let darkMode = false;
        let idleTimer;
        let sessionTimeout = 30 * 60 * 1000; // 30 minutes
        let currentPage = 'dashboardPage';

        // ============================================
        // MAIN ADMIN CREDENTIALS (Hardcoded)
        // ============================================
        const MAIN_ADMIN = {
            username: 'FrankJefwa',
            password: 'fj12345',
            name: 'Frank Jefwa',
            role: 'admin',
            isMainAdmin: true
        };

        // ============================================
        // SECURITY & AUTHENTICATION
        // ============================================

        // Enhanced password hashing
        function hashPassword(password) {
            let hash = 0;
            for (let i = 0; i < password.length; i++) {
                const char = password.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return 'hashed_' + Math.abs(hash).toString(36);
        }

        // Session management
        function resetIdleTimer() {
            clearTimeout(idleTimer);
            idleTimer = setTimeout(() => {
                if (currentUser) {
                    showNotification('Session expired due to inactivity', 'warning');
                    logout();
                }
            }, sessionTimeout);
        }

        function initSessionTracking() {
            document.addEventListener('mousemove', resetIdleTimer);
            document.addEventListener('keypress', resetIdleTimer);
            document.addEventListener('click', resetIdleTimer);
            resetIdleTimer();
        }

        // Password reset functionality
        function showForgotPassword() {
            document.getElementById('forgotPasswordModal').classList.add('active');
        }

        function hideForgotPassword() {
            document.getElementById('forgotPasswordModal').classList.remove('active');
        }

        function resetPassword() {
            const email = document.getElementById('resetEmail').value;
            const phone = document.getElementById('resetPhone').value;
            const username = document.getElementById('resetUsername').value;
            const securityQuestion = document.getElementById('securityQuestion').value;
            const securityAnswer = document.getElementById('securityAnswer').value;
            
            // Find user
            let user = null;
            if (email) {
                user = usersData.find(u => u.email === email);
            } else if (phone) {
                user = usersData.find(u => u.phone === phone);
            } else if (username) {
                user = usersData.find(u => u.username === username);
            }
            
            if (user) {
                // In production, send email/SMS with reset link
                showNotification('Password reset instructions have been sent to your registered email/phone', 'success');
                hideForgotPassword();
            } else {
                showNotification('No user found with the provided information', 'error');
            }
        }

        // Signup functionality
        function showSignup() {
            document.getElementById('signupModal').classList.add('active');
        }

        function hideSignup() {
            document.getElementById('signupModal').classList.remove('active');
            document.getElementById('signupName').value = '';
            document.getElementById('signupUsername').value = '';
            document.getElementById('signupEmail').value = '';
            document.getElementById('signupPhone').value = '';
            document.getElementById('signupRole').value = '';
            document.getElementById('signupPassword').value = '';
            document.getElementById('signupConfirmPassword').value = '';
        }

        function updateRoleFields() {
            const role = document.getElementById('signupRole').value;
            // Add role-specific field logic here
        }

        function signup() {
            const name = document.getElementById('signupName').value.trim();
            const username = document.getElementById('signupUsername').value.trim();
            const email = document.getElementById('signupEmail').value.trim();
            const phone = document.getElementById('signupPhone').value.trim();
            const role = document.getElementById('signupRole').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            
            // Validation
            if (!name || !username || !role || !password || !confirmPassword) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showNotification('Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Password must be at least 6 characters', 'error');
                return;
            }
            
            // Check if username already exists
            const existingUser = usersData.find(u => u.username === username);
            if (existingUser) {
                showNotification('Username already exists', 'error');
                return;
            }
            
            // Check if username is in pending approvals
            const pendingUser = pendingApprovalsData.find(u => u.username === username);
            if (pendingUser) {
                showNotification('This username is already pending approval', 'error');
                return;
            }
            
            // Create pending approval object
            const pendingApproval = {
                id: 'pending_' + Date.now(),
                name: name,
                username: username,
                email: email,
                phone: phone,
                role: role,
                passwordHash: hashPassword(password),
                status: 'pending',
                requestDate: new Date().toISOString(),
                approvedBy: null,
                approvedDate: null,
                rejectionReason: null
            };
            
            pendingApprovalsData.push(pendingApproval);
            saveToStorage();
            
            showNotification('Account request submitted! Please wait for admin approval.', 'success');
            hideSignup();
            
            // Clear login form
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            
            // Log activity
            logActivity('signup_request', `New user registration pending: ${username} (${role})`);
            
            // If main admin is logged in, show notification
            if (currentUser && currentUser.username === MAIN_ADMIN.username) {
                updatePendingApprovalsCount();
                showNotification(`New user registration from ${username} needs approval`, 'info');
            }
        }

        // Login function with admin approval check
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            if (!username || !password) {
                showNotification('Please enter username and password', 'error');
                return;
            }
            
            if (!currentRole) {
                showNotification('Please select your role', 'error');
                return;
            }
            
            // Check if it's the main admin
            if (username === MAIN_ADMIN.username && password === MAIN_ADMIN.password) {
                // Main admin login
                currentUser = {
                    id: 'main_admin_001',
                    username: MAIN_ADMIN.username,
                    name: MAIN_ADMIN.name,
                    role: MAIN_ADMIN.role,
                    isMainAdmin: true,
                    timestamp: new Date().toISOString()
                };
                
                // Save user session
                if (rememberMe) {
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                } else {
                    sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
                }
                
                // Switch to dashboard
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
                // Update UI
                document.getElementById('userName').textContent = currentUser.name;
                document.getElementById('userAvatar').textContent = getInitials(currentUser.name);
                
                // Update role badge
                const roleBadge = document.getElementById('userRole');
                roleBadge.textContent = 'Main Admin';
                roleBadge.className = `role-badge admin`;
                
                // Show admin navigation
                document.querySelectorAll('.nav-section').forEach(section => {
                    section.style.display = 'none';
                });
                document.getElementById('adminNav').style.display = 'block';
                
                // Initialize app
                initApp();
                showPage('dashboardPage');
                
                showNotification(`Welcome Main Administrator ${currentUser.name}!`, 'success');
                logActivity('login', 'Main admin logged in');
                
                // Initialize session tracking
                initSessionTracking();
                return;
            }
            
            // Check pending approvals first
            const pendingUser = pendingApprovalsData.find(u => u.username === username);
            if (pendingUser) {
                if (pendingUser.status === 'pending') {
                    showNotification('Your account is pending admin approval. Please wait for approval.', 'warning');
                    return;
                } else if (pendingUser.status === 'rejected') {
                    showNotification(`Your account was rejected. Reason: ${pendingUser.rejectionReason || 'Not specified'}`, 'error');
                    return;
                }
            }
            
            // Find user in approved users
            const user = usersData.find(u => u.username === username);
            
            if (!user) {
                showNotification('User not found or account not approved. Please sign up first.', 'error');
                return;
            }
            
            // Check password
            if (user.passwordHash !== hashPassword(password)) {
                showNotification('Invalid password', 'error');
                return;
            }
            
            // Check role
            if (user.role !== currentRole) {
                showNotification(`This account is registered as ${user.role}. Please select the correct role.`, 'error');
                return;
            }
            
            // Check if account is active
            if (user.status === 'inactive' || user.status === 'suspended') {
                showNotification('Your account is currently inactive. Please contact administrator.', 'error');
                return;
            }
            
            // Update last login
            user.lastLogin = new Date().toISOString();
            saveToStorage();
            
            // Create user session
            currentUser = {
                id: user.id,
                username: user.username,
                name: user.name,
                role: user.role,
                email: user.email,
                timestamp: new Date().toISOString()
            };
            
            // Save user session
            if (rememberMe) {
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
            } else {
                sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
            }
            
            // Switch to dashboard
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            
            // Update UI
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userAvatar').textContent = getInitials(currentUser.name);
            
            // Update role badge
            const roleBadge = document.getElementById('userRole');
            roleBadge.textContent = currentRole.charAt(0).toUpperCase() + currentRole.slice(1);
            roleBadge.className = `role-badge ${currentRole}`;
            
            // Show appropriate navigation
            document.querySelectorAll('.nav-section').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(`${currentRole}Nav`).style.display = 'block';
            
            // Initialize app
            initApp();
            showPage('dashboardPage');
            
            showNotification(`Welcome ${currentUser.name}! Login successful.`, 'success');
            logActivity('login', `User logged in: ${username}`);
            
            // Initialize session tracking
            initSessionTracking();
        }

        // ============================================
        // DATA MANAGEMENT
        // ============================================

        // Load data from localStorage
        function loadFromStorage() {
            try {
                scoresData = JSON.parse(localStorage.getItem('scoresData')) || [];
                studentsData = JSON.parse(localStorage.getItem('studentsData')) || [];
                settingsData = JSON.parse(localStorage.getItem('settingsData')) || {};
                subjectsData = JSON.parse(localStorage.getItem('subjectsData')) || [];
                usersData = JSON.parse(localStorage.getItem('usersData')) || [];
                pendingApprovalsData = JSON.parse(localStorage.getItem('pendingApprovalsData')) || [];
                attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
                announcementsData = JSON.parse(localStorage.getItem('announcementsData')) || [];
                messagesData = JSON.parse(localStorage.getItem('messagesData')) || [];
                eventsData = JSON.parse(localStorage.getItem('eventsData')) || [];
                achievementsData = JSON.parse(localStorage.getItem('achievementsData')) || [];
                auditLogData = JSON.parse(localStorage.getItem('auditLogData')) || [];
                backupsData = JSON.parse(localStorage.getItem('backupsData')) || [];
                apiLogData = JSON.parse(localStorage.getItem('apiLogData')) || [];
                reportCardsData = JSON.parse(localStorage.getItem('reportCardsData')) || [];
            } catch (e) {
                // Initialize all data structures
                scoresData = [];
                studentsData = [];
                settingsData = {};
                subjectsData = [];
                usersData = [];
                pendingApprovalsData = [];
                attendanceData = [];
                announcementsData = [];
                messagesData = [];
                eventsData = [];
                achievementsData = [];
                auditLogData = [];
                backupsData = [];
                apiLogData = [];
                reportCardsData = [];
            }
        }

        // Save data to localStorage
        function saveToStorage() {
            localStorage.setItem('scoresData', JSON.stringify(scoresData));
            localStorage.setItem('studentsData', JSON.stringify(studentsData));
            localStorage.setItem('settingsData', JSON.stringify(settingsData));
            localStorage.setItem('subjectsData', JSON.stringify(subjectsData));
            localStorage.setItem('usersData', JSON.stringify(usersData));
            localStorage.setItem('pendingApprovalsData', JSON.stringify(pendingApprovalsData));
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            localStorage.setItem('announcementsData', JSON.stringify(announcementsData));
            localStorage.setItem('messagesData', JSON.stringify(messagesData));
            localStorage.setItem('eventsData', JSON.stringify(eventsData));
            localStorage.setItem('achievementsData', JSON.stringify(achievementsData));
            localStorage.setItem('auditLogData', JSON.stringify(auditLogData));
            localStorage.setItem('backupsData', JSON.stringify(backupsData));
            localStorage.setItem('apiLogData', JSON.stringify(apiLogData));
            localStorage.setItem('reportCardsData', JSON.stringify(reportCardsData));
        }

        // Audit logging
        function logActivity(action, details) {
            const logEntry = {
                id: Date.now().toString(),
                timestamp: new Date().toISOString(),
                userId: currentUser ? currentUser.id : 'system',
                username: currentUser ? currentUser.username : 'system',
                action: action,
                details: details
            };
            auditLogData.push(logEntry);
            saveToStorage();
        }

        // ============================================
        // ADMIN APPROVAL SYSTEM
        // ============================================

        function loadPendingApprovals() {
            const tableBody = document.getElementById('pendingApprovalsTable');
            const pendingApprovals = pendingApprovalsData.filter(a => a.status === 'pending');
            
            if (pendingApprovals.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: #666;">
                            No pending approvals
                        </td>
                    </tr>
                `;
                updatePendingApprovalsCount();
                updateApprovalStats();
                return;
            }
            
            let html = '';
            pendingApprovals.forEach(approval => {
                const requestDate = new Date(approval.requestDate);
                const daysPending = Math.floor((new Date() - requestDate) / (1000 * 60 * 60 * 24));
                
                html += `
                    <tr>
                        <td>${approval.name}</td>
                        <td>${approval.username}</td>
                        <td>${approval.email || 'N/A'}</td>
                        <td><span class="role-badge ${approval.role}">${approval.role}</span></td>
                        <td>${requestDate.toLocaleDateString()}<br>
                            <small style="color: #666;">${daysPending} day${daysPending !== 1 ? 's' : ''} pending</small>
                        </td>
                        <td><span class="status-badge status-pending">Pending</span></td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-success" onclick="approveUser('${approval.id}')">
                                <i class="fas fa-check"></i> Approve
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="rejectUser('${approval.id}')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                            <button class="btn btn-sm btn-info" onclick="viewUserDetails('${approval.id}')">
                                <i class="fas fa-eye"></i> View
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            updatePendingApprovalsCount();
            updateApprovalStats();
        }

        function approveUser(approvalId) {
            const approval = pendingApprovalsData.find(a => a.id === approvalId);
            if (!approval) return;
            
            // Create user object
            const newUser = {
                id: 'user_' + Date.now(),
                username: approval.username,
                name: approval.name,
                passwordHash: approval.passwordHash,
                role: approval.role,
                email: approval.email,
                phone: approval.phone,
                status: 'active',
                created: new Date().toISOString(),
                lastLogin: null,
                approvedBy: currentUser.username,
                approvedDate: new Date().toISOString()
            };
            
            // Add to users
            usersData.push(newUser);
            
            // Update approval status
            approval.status = 'approved';
            approval.approvedBy = currentUser.username;
            approval.approvedDate = new Date().toISOString();
            
            saveToStorage();
            loadPendingApprovals();
            
            showNotification(`User ${approval.username} has been approved!`, 'success');
            logActivity('approve_user', `Approved user: ${approval.username} (${approval.role})`);
        }

        function rejectUser(approvalId) {
            const approval = pendingApprovalsData.find(a => a.id === approvalId);
            if (!approval) return;
            
            const reason = prompt('Please enter rejection reason:', 'Account does not meet requirements');
            if (reason === null) return;
            
            // Update approval status
            approval.status = 'rejected';
            approval.rejectionReason = reason;
            approval.rejectedBy = currentUser.username;
            approval.rejectedDate = new Date().toISOString();
            
            saveToStorage();
            loadPendingApprovals();
            
            showNotification(`User ${approval.username} has been rejected.`, 'warning');
            logActivity('reject_user', `Rejected user: ${approval.username} - Reason: ${reason}`);
        }

        function viewUserDetails(approvalId) {
            const approval = pendingApprovalsData.find(a => a.id === approvalId);
            if (!approval) return;
            
            const details = `
                Name: ${approval.name}
                Username: ${approval.username}
                Email: ${approval.email || 'N/A'}
                Phone: ${approval.phone || 'N/A'}
                Role: ${approval.role}
                Request Date: ${new Date(approval.requestDate).toLocaleString()}
                
                Submitted Information:
                - Role: ${approval.role}
                - Registration Date: ${new Date(approval.requestDate).toLocaleDateString()}
            `;
            
            showNotification(details, 'info');
        }

        function updatePendingApprovalsCount() {
            const pendingCount = pendingApprovalsData.filter(a => a.status === 'pending').length;
            const badge = document.getElementById('pendingApprovalsCount');
            if (badge) {
                badge.textContent = pendingCount;
                badge.style.display = pendingCount > 0 ? 'inline-block' : 'none';
            }
            document.getElementById('totalPendingApprovals').textContent = pendingCount;
        }

        function updateApprovalStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Count approved today
            const approvedToday = pendingApprovalsData.filter(a => 
                a.status === 'approved' && 
                a.approvedDate && 
                a.approvedDate.split('T')[0] === today
            ).length;
            
            // Count rejected today
            const rejectedToday = pendingApprovalsData.filter(a => 
                a.status === 'rejected' && 
                a.rejectedDate && 
                a.rejectedDate.split('T')[0] === today
            ).length;
            
            // Calculate average response time (in hours)
            const approvedRequests = pendingApprovalsData.filter(a => a.status === 'approved');
            let totalResponseTime = 0;
            
            approvedRequests.forEach(request => {
                const requestDate = new Date(request.requestDate);
                const approvalDate = new Date(request.approvedDate);
                const hours = (approvalDate - requestDate) / (1000 * 60 * 60);
                totalResponseTime += hours;
            });
            
            const avgResponseTime = approvedRequests.length > 0 
                ? Math.round(totalResponseTime / approvedRequests.length) 
                : 0;
            
            document.getElementById('approvedToday').textContent = approvedToday;
            document.getElementById('rejectedToday').textContent = rejectedToday;
            document.getElementById('avgResponseTime').textContent = avgResponseTime + 'h';
        }

        // ============================================
        // USER MANAGEMENT (FOR APPROVED USERS)
        // ============================================

        function loadUsersTable() {
            const tableBody = document.getElementById('usersTable');
            if (usersData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                            No approved users yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            usersData.forEach(user => {
                html += `
                    <tr>
                        <td>${user.username}</td>
                        <td>${user.name}</td>
                        <td><span class="role-badge ${user.role}">${user.role}</span></td>
                        <td>${new Date(user.created).toLocaleDateString()}</td>
                        <td>${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'Never'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-warning" onclick="suspendUser('${user.id}')" ${user.username === 'FrankJefwa' ? 'disabled' : ''}>
                                <i class="fas fa-pause"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.id}')" ${user.username === 'FrankJefwa' ? 'disabled' : ''}>
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function suspendUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            if (confirm(`Are you sure you want to suspend ${user.username}?`)) {
                user.status = 'suspended';
                saveToStorage();
                loadUsersTable();
                showNotification(`User ${user.username} has been suspended`, 'warning');
                logActivity('suspend_user', `Suspended user: ${user.username}`);
            }
        }

        function deleteUser(userId) {
            const user = usersData.find(u => u.id === userId);
            if (!user) return;
            
            if (confirm(`Are you sure you want to permanently delete ${user.username}? This action cannot be undone.`)) {
                // Remove from users
                usersData = usersData.filter(u => u.id !== userId);
                saveToStorage();
                loadUsersTable();
                showNotification(`User ${user.username} has been deleted`, 'success');
                logActivity('delete_user', `Deleted user: ${user.username}`);
            }
        }

        // ============================================
        // SCORE MANAGEMENT
        // ============================================

        function saveScore() {
            const studentName = document.getElementById('studentName').value;
            const subject = document.getElementById('subjectName').value;
            const score = parseInt(document.getElementById('scoreValue').value);
            const className = document.getElementById('className').value;
            const examType = document.getElementById('examType').value;
            const comments = document.getElementById('scoreComments').value.trim();
            
            // Validation
            if (!studentName || !subject || isNaN(score) || !className) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (score < 0 || score > 100) {
                showNotification('Score must be between 0 and 100', 'error');
                return;
            }
            
            // Find student
            const student = studentsData.find(s => s.name === studentName);
            if (!student) {
                showNotification('Student not found. Please add student first.', 'error');
                return;
            }
            
            // Calculate grade
            const grade = calculateGrade(score);
            
            // Create score object
            const newScore = {
                id: Date.now().toString(),
                studentId: student.id,
                studentName: studentName,
                subject: subject,
                score: score,
                grade: grade,
                className: className,
                examType: examType,
                comments: comments,
                date: new Date().toISOString().split('T')[0],
                addedBy: currentUser.username,
                addedAt: new Date().toISOString()
            };
            
            // Add to scores data
            scoresData.push(newScore);
            saveToStorage();
            
            // Clear form
            document.getElementById('scoreValue').value = '';
            document.getElementById('scoreComments').value = '';
            
            showNotification(`Score for ${studentName} saved successfully!`, 'success');
            logActivity('add_score', `${subject}: ${score}% for ${studentName}`);
            
            // Update displays
            updateDashboard();
            loadRecentAddedScores();
        }

        function saveAndNotify() {
            saveScore();
            // In production, add notification logic here
            showNotification('Score saved and notification sent', 'info');
        }

        function importCSV(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('importProgress').style.display = 'block';
                
                setTimeout(() => {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    let importedCount = 0;
                    
                    for (let i = 1; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        const parts = line.split(',');
                        if (parts.length >= 4) {
                            const studentName = parts[0].trim();
                            const subject = parts[1].trim();
                            const score = parseInt(parts[2].trim());
                            const className = parts[3].trim();
                            const examType = parts[4] ? parts[4].trim() : 'Imported';
                            
                            // Find or create student
                            let student = studentsData.find(s => s.name === studentName);
                            if (!student) {
                                student = {
                                    id: generateStudentId(),
                                    name: studentName,
                                    className: className,
                                    enrollmentDate: new Date().toISOString().split('T')[0]
                                };
                                studentsData.push(student);
                            }
                            
                            const newScore = {
                                id: Date.now().toString() + i,
                                studentId: student.id,
                                studentName: studentName,
                                subject: subject,
                                score: score,
                                grade: calculateGrade(score),
                                className: className,
                                examType: examType,
                                date: new Date().toISOString().split('T')[0],
                                addedBy: currentUser.username,
                                addedAt: new Date().toISOString()
                            };
                            
                            scoresData.push(newScore);
                            importedCount++;
                        }
                    }
                    
                    saveToStorage();
                    document.getElementById('importProgress').style.display = 'none';
                    showNotification(`Imported ${importedCount} scores successfully`, 'success');
                    logActivity('import_csv', `Imported ${importedCount} scores`);
                    updateDashboard();
                    loadRecentAddedScores();
                }, 1000);
            };
            reader.readAsText(file);
        }

        function loadRecentAddedScores() {
            const tableBody = document.getElementById('recentAddedScores');
            if (scoresData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                            No scores added yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Show last 10 scores
            const recentScores = scoresData.slice(-10).reverse();
            
            let html = '';
            recentScores.forEach(score => {
                html += `
                    <tr>
                        <td>${score.studentName}</td>
                        <td>${score.subject}</td>
                        <td><strong style="color: ${getScoreColor(score.score)}">${score.score}%</strong></td>
                        <td>${score.grade}</td>
                        <td>${formatDate(score.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteScore('${score.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ============================================
        // STUDENT MANAGEMENT
        // ============================================

        function addStudent() {
            const name = document.getElementById('newStudentName').value.trim();
            const className = document.getElementById('newStudentClass').value;
            const studentId = document.getElementById('newStudentId').value.trim() || generateStudentId();
            const dob = document.getElementById('newStudentDOB').value;
            const parent = document.getElementById('newStudentParent').value.trim();
            const phone = document.getElementById('newStudentPhone').value.trim();
            
            if (!name || !className) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Check if student already exists
            const existingStudent = studentsData.find(s => 
                s.id === studentId || s.name.toLowerCase() === name.toLowerCase()
            );
            
            if (existingStudent) {
                showNotification('Student already exists', 'error');
                return;
            }
            
            const newStudent = {
                id: studentId,
                name: name,
                className: className,
                dob: dob,
                parent: parent,
                phone: phone,
                enrollmentDate: new Date().toISOString().split('T')[0],
                averageScore: 0,
                totalScores: 0
            };
            
            studentsData.push(newStudent);
            saveToStorage();
            
            clearStudentForm();
            showNotification(`Student ${name} added successfully!`, 'success');
            logActivity('add_student', name);
            loadStudents();
            updateDashboard();
        }

        function loadStudents() {
            const tableBody = document.getElementById('studentsTable');
            if (studentsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                            No students registered yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            studentsData.forEach(student => {
                // Calculate average score
                const studentScores = scoresData.filter(s => s.studentId === student.id);
                const averageScore = studentScores.length > 0 
                    ? Math.round(studentScores.reduce((sum, s) => sum + s.score, 0) / studentScores.length)
                    : 0;
                
                html += `
                    <tr>
                        <td>${student.id}</td>
                        <td>${student.name}</td>
                        <td>${student.className}</td>
                        <td>${averageScore}%</td>
                        <td>${student.phone || 'N/A'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteStudent('${student.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function clearStudentForm() {
            document.getElementById('newStudentName').value = '';
            document.getElementById('newStudentId').value = '';
            document.getElementById('newStudentClass').value = '';
            document.getElementById('newStudentDOB').value = '';
            document.getElementById('newStudentParent').value = '';
            document.getElementById('newStudentPhone').value = '';
        }

        function generateStudentId() {
            const year = new Date().getFullYear().toString().slice(-2);
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `ST${year}${random}`;
        }

        // ============================================
        // ATTENDANCE MANAGEMENT
        // ============================================

        function loadClassAttendance() {
            const className = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;
            
            if (!className || !date) {
                return;
            }
            
            const classStudents = studentsData.filter(s => s.className === className);
            if (classStudents.length === 0) {
                showNotification('No students found in this class', 'warning');
                return;
            }
            
            // Show attendance table
            document.getElementById('attendanceTableContainer').style.display = 'block';
            
            let html = '';
            classStudents.forEach(student => {
                // Check existing attendance
                const existingAttendance = attendanceData.find(a => 
                    a.studentId === student.id && a.date === date
                );
                
                html += `
                    <tr>
                        <td>${student.name}</td>
                        <td>
                            <select id="attendance_${student.id}" style="width: 100%; padding: 8px;">
                                <option value="present" ${existingAttendance?.status === 'present' ? 'selected' : ''}>Present</option>
                                <option value="absent" ${existingAttendance?.status === 'absent' ? 'selected' : ''}>Absent</option>
                                <option value="late" ${existingAttendance?.status === 'late' ? 'selected' : ''}>Late</option>
                                <option value="excused" ${existingAttendance?.status === 'excused' ? 'selected' : ''}>Excused</option>
                            </select>
                        </td>
                        <td>
                            <input type="text" id="remarks_${student.id}" placeholder="Remarks" value="${existingAttendance?.remarks || ''}" style="width: 100%; padding: 8px;">
                        </td>
                    </tr>
                `;
            });
            
            document.getElementById('attendanceTable').innerHTML = html;
        }

        function saveAttendance() {
            const className = document.getElementById('attendanceClass').value;
            const date = document.getElementById('attendanceDate').value;
            const classStudents = studentsData.filter(s => s.className === className);
            
            let savedCount = 0;
            classStudents.forEach(student => {
                const status = document.getElementById(`attendance_${student.id}`).value;
                const remarks = document.getElementById(`remarks_${student.id}`).value;
                
                // Remove existing attendance for this student on this date
                attendanceData = attendanceData.filter(a => 
                    !(a.studentId === student.id && a.date === date)
                );
                
                // Add new attendance
                attendanceData.push({
                    id: Date.now().toString() + student.id,
                    studentId: student.id,
                    studentName: student.name,
                    className: className,
                    date: date,
                    status: status,
                    remarks: remarks,
                    recordedBy: currentUser.username,
                    recordedAt: new Date().toISOString()
                });
                
                savedCount++;
            });
            
            saveToStorage();
            showNotification(`Attendance saved for ${savedCount} students`, 'success');
            logActivity('save_attendance', `Marked attendance for ${className} on ${date}`);
        }

        // ============================================
        // CALENDAR MANAGEMENT
        // ============================================

        let currentCalendarDate = new Date();

        function loadCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            // Month and year display
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;
            
            // Get first day of month
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDay = firstDay.getDay();
            
            // Day names
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            let calendarHTML = '';
            
            // Add day headers
            dayNames.forEach(day => {
                calendarHTML += `<div class="calendar-day" style="font-weight: bold;">${day}</div>`;
            });
            
            // Add empty cells for days before first day of month
            for (let i = 0; i < startingDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }
            
            // Add days of month
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const hasEvent = eventsData.some(e => e.date === dateStr);
                const isToday = today.getDate() === day && 
                               today.getMonth() === month && 
                               today.getFullYear() === year;
                
                let dayClass = 'calendar-day';
                if (hasEvent) dayClass += ' event';
                if (isToday) dayClass += ' active';
                
                calendarHTML += `
                    <div class="${dayClass}" onclick="showDayEvents('${dateStr}')">
                        ${day}
                    </div>
                `;
            }
            
            document.getElementById('calendarGrid').innerHTML = calendarHTML;
            loadEvents();
        }

        function prevMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            loadCalendar();
        }

        function nextMonth() {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            loadCalendar();
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            
            if (!title || !date) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            const event = {
                id: Date.now().toString(),
                title: title,
                date: date,
                description: description,
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };
            
            eventsData.push(event);
            saveToStorage();
            loadCalendar();
            loadEvents();
            
            showNotification('Event added successfully', 'success');
            logActivity('add_event', title);
        }

        function loadEvents() {
            const tableBody = document.getElementById('eventsTable');
            if (eventsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #666;">
                            No events scheduled
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort events by date
            const sortedEvents = [...eventsData].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let html = '';
            sortedEvents.forEach(event => {
                html += `
                    <tr>
                        <td>${new Date(event.date).toLocaleDateString()}</td>
                        <td><strong>${event.title}</strong></td>
                        <td>${event.description || '-'}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteEvent('${event.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function deleteEvent(eventId) {
            if (confirm('Are you sure you want to delete this event?')) {
                eventsData = eventsData.filter(e => e.id !== eventId);
                saveToStorage();
                loadEvents();
                loadCalendar();
                showNotification('Event deleted', 'success');
                logActivity('delete_event', `Deleted event ID: ${eventId}`);
            }
        }

        function showDayEvents(dateStr) {
            const events = eventsData.filter(e => e.date === dateStr);
            if (events.length > 0) {
                let message = `Events on ${dateStr}:\n`;
                events.forEach(event => {
                    message += ` ${event.title}\n`;
                });
                showNotification(message, 'info');
            }
        }

        // ============================================
        // ANNOUNCEMENTS MANAGEMENT
        // ============================================

        function postAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;
            const audience = document.getElementById('announcementAudience').value;
            const priority = document.getElementById('announcementPriority').value;
            
            if (!title || !content) {
                showNotification('Please fill in all fields', 'error');
                return;
            }
            
            const announcement = {
                id: Date.now().toString(),
                title: title,
                content: content,
                author: currentUser.name,
                audience: audience,
                priority: priority,
                timestamp: new Date().toISOString(),
                readBy: []
            };
            
            announcementsData.push(announcement);
            saveToStorage();
            
            showNotification('Announcement posted successfully', 'success');
            loadAnnouncements();
            logActivity('post_announcement', title);
        }

        function loadAnnouncements() {
            const container = document.getElementById('announcementsList');
            if (announcementsData.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 50px; color: #666;">
                        <i class="fas fa-bullhorn" style="font-size: 48px; margin-bottom: 20px;"></i>
                        <p>No announcements yet</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            announcementsData.forEach(announcement => {
                html += `
                    <div class="announcement">
                        <h4>${announcement.title}</h4>
                        <p>${announcement.content}</p>
                        <div style="display: flex; justify-content: space-between; margin-top: 10px; font-size: 12px; color: #666;">
                            <span>By: ${announcement.author}</span>
                            <span>${new Date(announcement.timestamp).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // ============================================
        // ACHIEVEMENTS MANAGEMENT
        // ============================================

        function awardAchievement() {
            const studentId = document.getElementById('achievementStudent').value;
            const type = document.getElementById('achievementType').value;
            const description = document.getElementById('achievementDescription').value;
            
            const student = studentsData.find(s => s.id === studentId);
            if (!student) {
                showNotification('Student not found', 'error');
                return;
            }
            
            const achievement = {
                id: Date.now().toString(),
                studentId: studentId,
                studentName: student.name,
                type: type,
                description: description,
                awardedBy: currentUser.name,
                awardedAt: new Date().toISOString(),
                points: calculateAchievementPoints(type)
            };
            
            achievementsData.push(achievement);
            saveToStorage();
            loadAchievements();
            updateAchievementStats();
            
            showNotification(`Achievement awarded to ${student.name}`, 'success');
            logActivity('award_achievement', `${type} to ${student.name}`);
        }

        function calculateAchievementPoints(type) {
            const pointsMap = {
                'perfect_score': 50,
                'most_improved': 30,
                'attendance_perfect': 25,
                'helpful': 20,
                'leader': 40
            };
            return pointsMap[type] || 10;
        }

        function loadAchievements() {
            const tableBody = document.getElementById('achievementsTable');
            if (achievementsData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #666;">
                            No achievements awarded yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by date (newest first)
            const sortedAchievements = [...achievementsData].sort((a, b) => 
                new Date(b.awardedAt) - new Date(a.awardedAt)
            );
            
            let html = '';
            sortedAchievements.forEach(achievement => {
                html += `
                    <tr>
                        <td>${achievement.studentName}</td>
                        <td>${achievement.type}</td>
                        <td>${new Date(achievement.awardedAt).toLocaleDateString()}</td>
                        <td>${achievement.points}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function updateAchievementStats() {
            // Total badges
            document.getElementById('totalBadges').textContent = achievementsData.length;
            
            // Top student
            const studentAchievements = {};
            achievementsData.forEach(a => {
                if (!studentAchievements[a.studentId]) {
                    studentAchievements[a.studentId] = { count: 0, name: a.studentName };
                }
                studentAchievements[a.studentId].count++;
            });
            
            let topStudent = null;
            let maxAchievements = 0;
            Object.values(studentAchievements).forEach(student => {
                if (student.count > maxAchievements) {
                    maxAchievements = student.count;
                    topStudent = student.name;
                }
            });
            
            document.getElementById('topStudentName').textContent = topStudent || '-';
            
            // Points leader
            const studentPoints = {};
            achievementsData.forEach(a => {
                if (!studentPoints[a.studentId]) {
                    studentPoints[a.studentId] = 0;
                }
                studentPoints[a.studentId] += a.points;
            });
            
            let maxPoints = 0;
            Object.values(studentPoints).forEach(points => {
                if (points > maxPoints) {
                    maxPoints = points;
                }
            });
            
            document.getElementById('pointsLeader').textContent = maxPoints;
        }

        // ============================================
        // VIEW ALL SCORES
        // ============================================

        function loadAllScores() {
            const tableBody = document.getElementById('allScoresTable');
            if (scoresData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px; color: #666;">
                            No scores available
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            scoresData.forEach(score => {
                html += `
                    <tr>
                        <td>${score.studentName}</td>
                        <td>${score.className}</td>
                        <td>${score.subject}</td>
                        <td>${score.score}%</td>
                        <td>${score.grade}</td>
                        <td>${score.examType}</td>
                        <td>${formatDate(score.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteScore('${score.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function filterScores() {
            const className = document.getElementById('filterClass').value;
            const subject = document.getElementById('filterSubject').value.toLowerCase();
            
            const tableBody = document.getElementById('allScoresTable');
            let filteredScores = scoresData;
            
            if (className) {
                filteredScores = filteredScores.filter(score => score.className === className);
            }
            
            if (subject) {
                filteredScores = filteredScores.filter(score => 
                    score.subject.toLowerCase().includes(subject)
                );
            }
            
            if (filteredScores.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="8" style="text-align: center; padding: 30px; color: #666;">
                            No scores match the filter criteria
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredScores.forEach(score => {
                html += `
                    <tr>
                        <td>${score.studentName}</td>
                        <td>${score.className}</td>
                        <td>${score.subject}</td>
                        <td>${score.score}%</td>
                        <td>${score.grade}</td>
                        <td>${score.examType}</td>
                        <td>${formatDate(score.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteScore('${score.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        // ============================================
        // AUDIT LOG
        // ============================================

        function loadAuditLog() {
            const tableBody = document.getElementById('auditLogTable');
            if (auditLogData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #666;">
                            No audit logs yet
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Sort by timestamp (newest first)
            const sortedLogs = [...auditLogData].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            let html = '';
            sortedLogs.forEach(log => {
                html += `
                    <tr>
                        <td>${new Date(log.timestamp).toLocaleString()}</td>
                        <td>${log.username}</td>
                        <td>${log.action}</td>
                        <td>${log.details}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
            
            // Populate user filter
            const userFilter = document.getElementById('auditUserFilter');
            const uniqueUsers = [...new Set(auditLogData.map(log => log.username))];
            uniqueUsers.forEach(username => {
                const option = document.createElement('option');
                option.value = username;
                option.textContent = username;
                userFilter.appendChild(option);
            });
        }

        function filterAuditLog() {
            const userFilter = document.getElementById('auditUserFilter').value;
            const actionFilter = document.getElementById('auditActionFilter').value;
            
            let filteredLogs = auditLogData;
            
            if (userFilter) {
                filteredLogs = filteredLogs.filter(log => log.username === userFilter);
            }
            
            if (actionFilter) {
                filteredLogs = filteredLogs.filter(log => log.action === actionFilter);
            }
            
            const tableBody = document.getElementById('auditLogTable');
            if (filteredLogs.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="4" style="text-align: center; padding: 30px; color: #666;">
                            No matching audit logs
                        </td>
                    </tr>
                `;
                return;
            }
            
            let html = '';
            filteredLogs.forEach(log => {
                html += `
                    <tr>
                        <td>${new Date(log.timestamp).toLocaleString()}</td>
                        <td>${log.username}</td>
                        <td>${log.action}</td>
                        <td>${log.details}</td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function exportAuditLog() {
            const csv = 'Timestamp,User,Action,Details\n' +
                auditLogData.map(log => 
                    `"${new Date(log.timestamp).toLocaleString()}","${log.username}","${log.action}","${log.details}"`
                ).join('\n');
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `audit_log_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Audit log exported', 'success');
        }

        function clearAuditLog() {
            if (confirm('Are you sure you want to clear all audit logs? This action cannot be undone.')) {
                auditLogData = [];
                saveToStorage();
                loadAuditLog();
                showNotification('Audit log cleared', 'success');
                logActivity('clear_audit_log', 'All audit logs cleared');
            }
        }

        // ============================================
        // BACKUP & RESTORE
        // ============================================

        function createBackup() {
            const backup = {
                id: Date.now().toString(),
                name: `Backup_${new Date().toISOString().split('T')[0]}`,
                timestamp: new Date().toISOString(),
                data: {
                    scoresData: scoresData,
                    studentsData: studentsData,
                    usersData: usersData,
                    settingsData: settingsData,
                    attendanceData: attendanceData,
                    pendingApprovalsData: pendingApprovalsData,
                    announcementsData: announcementsData,
                    achievementsData: achievementsData,
                    eventsData: eventsData
                }
            };
            
            backupsData.push(backup);
            saveToStorage();
            
            // Create downloadable file
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `score_system_backup_${backup.id}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Backup created and downloaded successfully', 'success');
            logActivity('create_backup', 'System backup created');
        }

        function scheduleBackup() {
            showNotification('Auto-backup scheduled (weekly on Sundays)', 'info');
            // In production, implement with setInterval or server-side cron job
        }

        function restoreBackup(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (confirm('Are you sure you want to restore this backup? All current data will be overwritten.')) {
                        // Restore data
                        scoresData = backup.data.scoresData || [];
                        studentsData = backup.data.studentsData || [];
                        usersData = backup.data.usersData || [];
                        settingsData = backup.data.settingsData || {};
                        attendanceData = backup.data.attendanceData || [];
                        pendingApprovalsData = backup.data.pendingApprovalsData || [];
                        announcementsData = backup.data.announcementsData || [];
                        achievementsData = backup.data.achievementsData || [];
                        eventsData = backup.data.eventsData || [];
                        
                        saveToStorage();
                        initApp();
                        showNotification('Backup restored successfully', 'success');
                        logActivity('restore_backup', `Restored from ${backup.name}`);
                    }
                } catch (error) {
                    showNotification('Invalid backup file', 'error');
                }
            };
            reader.readAsText(file);
        }

        function backupData() {
            createBackup();
        }

        // ============================================
        // SYSTEM SETTINGS
        // ============================================

        function loadSettings() {
            document.getElementById('schoolName').value = settingsData.schoolName || '';
            document.getElementById('academicYear').value = settingsData.academicYear || '2024-2025';
            document.getElementById('passMark').value = settingsData.passMark || 40;
            document.getElementById('maxScore').value = settingsData.maxScore || 100;
        }

        function saveSettings() {
            settingsData.schoolName = document.getElementById('schoolName').value.trim();
            settingsData.academicYear = document.getElementById('academicYear').value.trim();
            settingsData.passMark = parseInt(document.getElementById('passMark').value) || 40;
            settingsData.maxScore = parseInt(document.getElementById('maxScore').value) || 100;
            
            saveToStorage();
            showNotification('Settings saved successfully!', 'success');
            logActivity('save_settings', 'System settings updated');
        }

        function resetSettings() {
            if (confirm('Reset all settings to default?')) {
                settingsData = {
                    schoolName: "Excel High School",
                    academicYear: "2024-2025",
                    passMark: 40,
                    maxScore: 100
                };
                saveToStorage();
                loadSettings();
                showNotification('Settings reset to default', 'info');
                logActivity('reset_settings', 'Settings reset to default');
            }
        }

        // ============================================
        // REPORT CARDS
        // ============================================

        function generateReportCard() {
            const studentId = document.getElementById('reportCardStudent').value;
            const term = document.getElementById('reportCardTerm').value;
            
            const student = studentsData.find(s => s.id === studentId);
            if (!student) {
                showNotification('Please select a student', 'error');
                return;
            }
            
            // Filter scores for this student
            const studentScores = scoresData.filter(s => s.studentId === studentId);
            if (studentScores.length === 0) {
                showNotification('No scores found for this student', 'error');
                return;
            }
            
            // Calculate statistics
            const averageScore = Math.round(studentScores.reduce((sum, s) => sum + s.score, 0) / studentScores.length);
            const grade = calculateGrade(averageScore);
            
            // Create report card
            const reportCard = {
                id: Date.now().toString(),
                studentId: studentId,
                studentName: student.name,
                className: student.className,
                term: term,
                averageScore: averageScore,
                grade: grade,
                generatedDate: new Date().toISOString(),
                generatedBy: currentUser.username,
                scores: studentScores
            };
            
            reportCardsData.push(reportCard);
            saveToStorage();
            
            showNotification(`Report card generated for ${student.name}`, 'success');
            logActivity('generate_report_card', `Generated for ${student.name} (Term ${term})`);
            
            // Download as PDF (simulated)
            setTimeout(() => {
                const reportContent = `
                    REPORT CARD
                    Student: ${student.name}
                    Class: ${student.className}
                    Term: ${term}
                    Average Score: ${averageScore}%
                    Grade: ${grade}
                    Generated: ${new Date().toLocaleString()}
                    
                    Subject Scores:
                    ${studentScores.map(s => `${s.subject}: ${s.score}% (${s.grade})`).join('\n')}
                `;
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `report_card_${student.name}_term_${term}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 1000);
        }

        function previewReportCard() {
            showNotification('Preview feature would show report card here', 'info');
        }

        // ============================================
        // REPORTS & ANALYSIS
        // ============================================

        function generateCustomReport() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('reportDateRange').value;
            
            showNotification(`Generating ${reportType} report for ${dateRange}...`, 'info');
            
            // Simulate report generation
            setTimeout(() => {
                showNotification('Report generated successfully! Check your downloads.', 'success');
                
                const reportContent = `
                    CUSTOM REPORT
                    Type: ${reportType}
                    Date Range: ${dateRange}
                    Generated: ${new Date().toLocaleString()}
                    
                    Summary:
                    - Total Students: ${studentsData.length}
                    - Total Scores: ${scoresData.length}
                    - Average Score: ${scoresData.length > 0 ? 
                        Math.round(scoresData.reduce((sum, s) => sum + s.score, 0) / scoresData.length) : 0}%
                    - Attendance Rate: ${Math.floor(Math.random() * 20) + 80}%
                    
                    Generated by: ${currentUser.name}
                `;
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `custom_report_${reportType}_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 2000);
        }

        function exportReport() {
            showNotification('Exporting report as PDF...', 'info');
        }

        // ============================================
        // CLASS ANALYSIS
        // ============================================

        function loadClassAnalysis() {
            const className = document.getElementById('analysisClass').value;
            const subject = document.getElementById('analysisSubject').value;
            
            if (!className) {
                return;
            }
            
            // Filter students in class
            const classStudents = studentsData.filter(s => s.className === className);
            
            if (classStudents.length === 0) {
                document.getElementById('classAverage').textContent = '0%';
                document.getElementById('classTopStudent').textContent = '-';
                document.getElementById('classPassRate').textContent = '0%';
                document.getElementById('classImprovement').textContent = '0%';
                document.getElementById('classRankingTable').innerHTML = `
                    <tr><td colspan="5" style="text-align: center; padding: 30px; color: #666;">No students in this class</td></tr>
                `;
                return;
            }
            
            // Calculate class statistics
            let totalScore = 0;
            let totalScores = 0;
            let passingStudents = 0;
            const passMark = settingsData.passMark || 40;
            
            const studentRankings = [];
            
            classStudents.forEach(student => {
                // Filter student scores
                let studentScores = scoresData.filter(s => s.studentId === student.id);
                if (subject) {
                    studentScores = studentScores.filter(s => s.subject === subject);
                }
                
                if (studentScores.length > 0) {
                    const averageScore = Math.round(studentScores.reduce((sum, s) => sum + s.score, 0) / studentScores.length);
                    totalScore += averageScore;
                    totalScores++;
                    
                    if (averageScore >= passMark) {
                        passingStudents++;
                    }
                    
                    studentRankings.push({
                        name: student.name,
                        averageScore: averageScore,
                        grade: calculateGrade(averageScore),
                        improvement: Math.floor(Math.random() * 20) - 5 // Simulated improvement
                    });
                }
            });
            
            // Sort by average score (descending)
            studentRankings.sort((a, b) => b.averageScore - a.averageScore);
            
            // Update statistics
            const classAverage = totalScores > 0 ? Math.round(totalScore / totalScores) : 0;
            const passRate = classStudents.length > 0 ? Math.round((passingStudents / classStudents.length) * 100) : 0;
            
            document.getElementById('classAverage').textContent = classAverage + '%';
            document.getElementById('classPassRate').textContent = passRate + '%';
            document.getElementById('classImprovement').textContent = '+5%'; // Simulated
            
            // Top student
            if (studentRankings.length > 0) {
                document.getElementById('classTopStudent').textContent = studentRankings[0].name;
            } else {
                document.getElementById('classTopStudent').textContent = '-';
            }
            
            // Update ranking table
            let html = '';
            studentRankings.forEach((student, index) => {
                html += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${student.name}</td>
                        <td>${student.averageScore}%</td>
                        <td>${student.grade}</td>
                        <td>${student.improvement > 0 ? '+' : ''}${student.improvement}%</td>
                    </tr>
                `;
            });
            
            if (html === '') {
                html = `<tr><td colspan="5" style="text-align: center; padding: 30px; color: #666;">No scores available for this class</td></tr>`;
            }
            
            document.getElementById('classRankingTable').innerHTML = html;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================

        function selectRole(role) {
            currentRole = role;
            document.querySelectorAll('.role-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const toggle = field.parentNode.querySelector('.password-toggle i');
            if (field.type === 'password') {
                field.type = 'text';
                toggle.className = 'fas fa-eye-slash';
            } else {
                field.type = 'password';
                toggle.className = 'fas fa-eye';
            }
        }

        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected page
            const page = document.getElementById(pageId);
            if (page) {
                page.style.display = 'block';
                currentPage = pageId;
                
                // Load page-specific data
                switch(pageId) {
                    case 'dashboardPage':
                        updateDashboard();
                        break;
                    case 'pendingApprovals':
                        if (currentUser && currentUser.isMainAdmin) {
                            loadPendingApprovals();
                        } else {
                            showPage('dashboardPage');
                            showNotification('Access denied. Main admin only.', 'error');
                        }
                        break;
                    case 'addScores':
                        loadRecentAddedScores();
                        populateStudentSelect();
                        break;
                    case 'viewAllScores':
                        loadAllScores();
                        break;
                    case 'manageStudents':
                        loadStudents();
                        break;
                    case 'userManagement':
                        if (currentUser && currentUser.isMainAdmin) {
                            loadUsersTable();
                        } else {
                            showPage('dashboardPage');
                            showNotification('Access denied. Admin only.', 'error');
                        }
                        break;
                    case 'attendance':
                        // Set today's date as default
                        document.getElementById('attendanceDate').valueAsDate = new Date();
                        break;
                    case 'calendar':
                        loadCalendar();
                        break;
                    case 'announcements':
                        loadAnnouncements();
                        break;
                    case 'auditLog':
                        loadAuditLog();
                        break;
                    case 'achievements':
                        loadAchievements();
                        updateAchievementStats();
                        populateAchievementStudentSelect();
                        break;
                    case 'systemSettings':
                        loadSettings();
                        break;
                    case 'reportCards':
                        populateReportCardStudentSelect();
                        break;
                    case 'reports':
                        // Initialize report type change listener
                        document.getElementById('reportDateRange').addEventListener('change', function() {
                            document.getElementById('customDateRange').style.display = 
                                this.value === 'custom' ? 'block' : 'none';
                        });
                        break;
                    case 'classAnalysis':
                        // Initialize class analysis
                        document.getElementById('analysisSubject').addEventListener('change', loadClassAnalysis);
                        break;
                    case 'backupRestore':
                        loadBackupsTable();
                        break;
                }
                
                // Add active class to nav item
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    if (item.textContent.includes(pageId.replace(/([A-Z])/g, ' $1').trim().split(' ')[0])) {
                        item.classList.add('active');
                    }
                });
            }
        }

        function updateDashboard() {
            // Calculate statistics
            const totalStudents = studentsData.length;
            
            let totalScore = 0;
            let averageScore = 0;
            let pendingActions = 0;
            
            if (scoresData.length > 0) {
                totalScore = scoresData.reduce((sum, score) => sum + score.score, 0);
                averageScore = Math.round(totalScore / scoresData.length);
                pendingActions = scoresData.filter(s => s.score < (settingsData.passMark || 40)).length;
            }
            
            // Calculate attendance rate (simulated)
            const attendanceRate = Math.min(95, Math.floor(Math.random() * 20) + 80);
            
            // Update UI
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('averageScore').textContent = averageScore + '%';
            document.getElementById('attendanceRate').textContent = attendanceRate + '%';
            document.getElementById('pendingActions').textContent = pendingActions;
            
            // Update recent scores table
            updateRecentScoresTable();
        }

        function updateRecentScoresTable() {
            const tableBody = document.getElementById('recentScoresTable');
            if (scoresData.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 30px; color: #666;">
                            No scores entered yet. Add your first score!
                        </td>
                    </tr>
                `;
                return;
            }
            
            // Show last 10 scores
            const recentScores = scoresData.slice(-10).reverse();
            
            let html = '';
            recentScores.forEach(score => {
                html += `
                    <tr>
                        <td>${score.studentName}</td>
                        <td>${score.subject}</td>
                        <td><strong style="color: ${getScoreColor(score.score)}">${score.score}%</strong></td>
                        <td>${score.grade}</td>
                        <td>${formatDate(score.date)}</td>
                        <td class="action-buttons">
                            <button class="btn btn-sm btn-danger" onclick="deleteScore('${score.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = html;
        }

        function populateStudentSelect() {
            const select = document.getElementById('studentName');
            select.innerHTML = '<option value="">Select Student</option>';
            studentsData.forEach(student => {
                const option = document.createElement('option');
                option.value = student.name;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }

        function populateAchievementStudentSelect() {
            const select = document.getElementById('achievementStudent');
            select.innerHTML = '<option value="">Select Student</option>';
            studentsData.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }

        function populateReportCardStudentSelect() {
            const select = document.getElementById('reportCardStudent');
            select.innerHTML = '<option value="">Select Student</option>';
            studentsData.forEach(student => {
                const option = document.createElement('option');
                option.value = student.id;
                option.textContent = student.name;
                select.appendChild(option);
            });
        }

        function autoFillStudentInfo() {
            const studentName = document.getElementById('studentName').value;
            const student = studentsData.find(s => s.name === studentName);
            if (student) {
                document.getElementById('studentId').value = student.id;
                document.getElementById('className').value = student.className || '';
            }
        }

        function deleteScore(scoreId) {
            if (confirm('Are you sure you want to delete this score?')) {
                scoresData = scoresData.filter(score => score.id !== scoreId);
                saveToStorage();
                showNotification('Score deleted successfully', 'success');
                logActivity('delete_score', `Deleted score ID: ${scoreId}`);
                
                // Update all displays
                if (currentPage === 'dashboardPage') updateDashboard();
                if (currentPage === 'addScores') loadRecentAddedScores();
                if (currentPage === 'viewAllScores') loadAllScores();
            }
        }

        function deleteStudent(studentId) {
            if (confirm('Are you sure you want to delete this student? This will also delete all their scores.')) {
                // Remove student
                studentsData = studentsData.filter(student => student.id !== studentId);
                
                // Remove student's scores
                scoresData = scoresData.filter(score => score.studentId !== studentId);
                
                saveToStorage();
                showNotification('Student deleted successfully', 'success');
                logActivity('delete_student', `Deleted student ID: ${studentId}`);
                
                // Update displays
                if (currentPage === 'manageStudents') loadStudents();
                if (currentPage === 'dashboardPage') updateDashboard();
                if (currentPage === 'addScores') populateStudentSelect();
            }
        }

        function calculateGrade(score) {
            if (score >= 80) return 'A';
            if (score >= 70) return 'B';
            if (score >= 60) return 'C';
            if (score >= 50) return 'D';
            if (score >= 40) return 'E';
            return 'F';
        }

        function getScoreColor(score) {
            const passMark = settingsData.passMark || 40;
            if (score >= 80) return '#2ecc71';
            if (score >= passMark) return '#f39c12';
            return '#e74c3c';
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2) || 'U';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 
                                  type === 'error' ? 'exclamation-circle' : 
                                  type === 'warning' ? 'exclamation-triangle' : 
                                  'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        function toggleDarkMode() {
            darkMode = !darkMode;
            if (darkMode) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
            }
        }

        function showNotifications() {
            showNotification('No new notifications', 'info');
        }

        function generateReport() {
            showNotification('Report generation started...', 'info');
            setTimeout(() => {
                showNotification('Report generated successfully! Check your downloads.', 'success');
                
                // Create a simple report
                const reportContent = `
                    Digital Score Management System - Report
                    Generated: ${new Date().toLocaleString()}
                    
                    Total Students: ${studentsData.length}
                    Total Scores: ${scoresData.length}
                    Average Score: ${scoresData.length > 0 ? 
                        Math.round(scoresData.reduce((sum, s) => sum + s.score, 0) / scoresData.length) : 0}%
                    
                    --- End of Report ---
                `;
                
                const blob = new Blob([reportContent], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `report_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 1000);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Clear current user
                currentUser = null;
                localStorage.removeItem('currentUser');
                sessionStorage.removeItem('currentUser');
                
                // Show login screen
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                
                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                showNotification('Logged out successfully', 'info');
            }
        }

        // ============================================
        // INITIALIZATION
        // ============================================

        function initApp() {
            loadFromStorage();
            
            // Set current date
            const now = new Date();
            document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Initialize settings if empty
            if (!settingsData.schoolName) {
                settingsData = {
                    schoolName: "Excel High School",
                    academicYear: "2024-2025",
                    passMark: 40,
                    maxScore: 100
                };
                saveToStorage();
            }
            
            // Update pending approvals count
            updatePendingApprovalsCount();
            
            // Load dark mode preference
            const savedDarkMode = localStorage.getItem('darkMode');
            if (savedDarkMode === 'true') {
                darkMode = true;
                document.body.classList.add('dark-mode');
            }
            
            // Update dashboard
            updateDashboard();
            
            // Initialize session tracking
            initSessionTracking();
        }

        // ============================================
        // EVENT LISTENERS AND INITIALIZATION
        // ============================================

        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners
            document.getElementById('signupRole').addEventListener('change', updateRoleFields);
            
            // Check for existing session
            try {
                const savedUser = JSON.parse(localStorage.getItem('currentUser')) || 
                                 JSON.parse(sessionStorage.getItem('currentUser'));
                if (savedUser && savedUser.username) {
                    currentUser = savedUser;
                    currentRole = savedUser.role || 'admin';
                    
                    // Auto login
                    document.getElementById('loginScreen').style.display = 'none';
                    document.getElementById('dashboard').style.display = 'block';
                    
                    // Update UI
                    document.getElementById('userName').textContent = currentUser.name;
                    document.getElementById('userAvatar').textContent = getInitials(currentUser.name);
                    document.getElementById('userRole').textContent = 
                        currentUser.isMainAdmin ? 'Main Admin' : currentRole.charAt(0).toUpperCase() + currentRole.slice(1);
                    document.getElementById('userRole').className = `role-badge ${currentRole}`;
                    
                    // Show appropriate navigation
                    document.querySelectorAll('.nav-section').forEach(section => {
                        section.style.display = 'none';
                    });
                    document.getElementById(`${currentRole}Nav`).style.display = 'block';
                    
                    // Initialize app
                    initApp();
                    showPage('dashboardPage');
                }
            } catch (e) {
                localStorage.removeItem('currentUser');
                sessionStorage.removeItem('currentUser');
            }
            
            // Add enter key support for login
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            
            // Add slideOut animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
